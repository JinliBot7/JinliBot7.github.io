<!DOCTYPE html>
<html>

  <head>
    
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>

  Luyin Hu 胡鲁印


  | Differentiable Cloth Modeling

</title>
<meta name="description" content="">

<!-- Open Graph -->


<!-- Bootstrap & MDB -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" integrity="sha512-RO38pBRxYH3SoOprtPTD86JFOclM51/XTIdEPh5j8sj4tp8jmQIx26twG52UaLi//hQldfrh7e51WzP9wuP32Q==" crossorigin="anonymous" />

<!-- Fonts & Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"  integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

<!-- Code Syntax Highlighting -->
<link rel="stylesheet" href="https://gitcdn.link/repo/jwarby/jekyll-pygments-themes/master/github.css" />

<!-- Styles -->

<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22></text></svg>">

<link rel="stylesheet" href="/assets/css/main.css">
<link rel="canonical" href="/projects/cloth/">

<!-- JQuery -->
<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>


<!-- Theming-->

<script src="/assets/js/theme.js"></script>
<script src="/assets/js/dark_mode.js"></script>





<!-- Panelbear Analytics - We respect your privacy -->
<script async src="https://cdn.panelbear.com/analytics.js?site=1iRLzfO2lA9"></script>
<script>
    window.panelbear = window.panelbear || function() { (window.panelbear.q = window.panelbear.q || []).push(arguments); };
    panelbear('config', { site: '1iRLzfO2lA9' });
</script>


    
<!-- MathJax -->
<script type="text/javascript">
  window.MathJax = {
    tex: {
      tags: 'ams'
    }
  };
</script>
<script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
<script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>


  </head>

  <body class="fixed-top-nav ">

    <!-- Header -->

    <header>

    <!-- Nav Bar -->
    <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
    <div class="container">
      
      <a class="navbar-brand title font-weight-lighter" href="https://JinliBot7.github.io/">
       Luyin Hu 胡鲁印
      </a>
      
      <!-- Navbar Toggle -->
      <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar top-bar"></span>
        <span class="icon-bar middle-bar"></span>
        <span class="icon-bar bottom-bar"></span>
      </button>
      <div class="collapse navbar-collapse text-right" id="navbarNav">
        <ul class="navbar-nav ml-auto flex-nowrap">
          <!-- About -->
          <li class="nav-item ">
            <a class="nav-link" href="/">
              About
              
            </a>
          </li>
          
          <!-- Blog -->
          <!-- <li class="nav-item ">
            <a class="nav-link" href="/blog/">
              blog
              
            </a>
          </li>
           -->
          <!-- Other pages -->
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/projects/">
                Projects
                
              </a>
          </li>
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/publications/">
                Publications
                
              </a>
          </li>
          
          
          
          
          
          
          
          
          
          <!-- <li class="nav-item dropdown ">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                submenus
                
              </a>
              <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
              
              
                <a class="dropdown-item" href="/publications/">publications</a>
              
              
              
                <div class="dropdown-divider"></div>
              
              
              
                <a class="dropdown-item" href="/projects/">projects</a>
              
              
              </div>
          </li> -->
          <!-- 
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/teaching/">
                teaching
                
              </a>
          </li>
          
          
           -->
          
            <div class="toggle-container">
              <a id="light-toggle">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
              </a>
            </div>
          
        </ul>
      </div>
    </div>
  </nav>

</header>


    <!-- Content -->

    <div class="container mt-5">
      <div class="post">

  <header class="post-header">
    <h1 class="post-title">Differentiable Cloth Modeling</h1>
    <p class="post-description">2022/07 - now</p>
  </header>

  <article>
    <p>
<em>Updated on 2022/12/09</em>
</p>

<p>I have implemented three types of cloth simulation methods, including</p>

<ul>
  <li>Mass-Spring-System</li>
  <li>Finite Element Method</li>
  <li>Material Point Method</li>
</ul>

<p>I use forward or symplectic Euler integration at this stage. Implicit integration may be implemented in the future. I found it is helpful to keep things simple at the beginning.</p>

<h2> Mass-Spring-System </h2>
<p>
The Mass-Spring-System method is popular for real-time applications in robotics due to its simplicity. It models the deformable objects as a collection of particles connected by springs and dampers. However, the conciseness comes with the price of the lost of physical interpretability. It is not suitable for scenarios that involve large deformation, severe self-occulusion, and multiple material coupling. Here is an implementation in Taichi.
</p>

<p align="center">
  <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/1-mass-spring.gif">
</p>

<h2> Finite Element Method </h2>
<p>
The finite element method (FEM) is a numerical method for solving differential equations arising in engineering and mathematical modeling. Usually, the continuum material is discretized into triangular or tetrahedron elements. Then the deformation gradient and the internal stress are computed for each element. I tried to follow the classic 1998 SIGGRAPH paper <a href="https://www.cs.cmu.edu/~baraff/papers/sig98.pdf" target="_blank" rel="noopener noreferrer">"Large Steps in Cloth Simulation"</a>. A preliminary result is attached below. However, the self-collision was not handled properly and only the streching component of the energy density function was implemented. I didn't complete the full implementation since I found the result of the material point method (MPM), the state of the art method for deformbale object and granular particle simulation in the computer graphics community, is more promising. 
</p>

<p align="center">
  <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth_video.gif">
</p>

<h2> Material Point Method </h2>
<p>A simple toy example of my MPM framework. Easy to debug.</p>
<p align="center">
  <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/0-mpm-simple.gif">
</p>

<p>Let’s push a deformable sheet.</p>

<p align="center">
  <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/2-push.gif">
</p>

<p>Let’s add the mesh indices and twist a deformable sheet. Green color represents det(F) &gt; 1 and red represents det(F) &lt; 1. Note that this is hard to achieve utilizing the traditional methods.</p>
<p align="center">
  <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/t-1000.gif">
</p>

<p>Change of the Young’s modulus affect the twisting process.</p>
<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/t-100.gif" alt="" title="example image">
    </div>
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/t-500.gif" alt="" title="example image">
    </div>  
</div>
<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/t-1000.gif" alt="" title="example image">
    </div>
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/t-3000.gif" alt="" title="example image">
    </div>  
</div>

<p><br>
I also did some experiments using a real peice of garment.</p>
<p align="center">
  <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/7-twist-real.gif">
</p>

<p><br>
Let’s also shear a deformable sheet.</p>
<p align="center">
  <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/s-2000.gif">
</p>

<p>Change of the Young’s modulus affect the shearing result.</p>
<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/s-100.gif" alt="" title="example image">
    </div>
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/s-500.gif" alt="" title="example image">
    </div>  
</div>
<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/s-1000.gif" alt="" title="example image">
    </div>
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/s-2000.gif" alt="" title="example image">
    </div>  
</div>
<p><br></p>

<p>I also did some experiments using a real peice of garment.</p>
<p align="center">
  <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/6-shear-real.gif">
</p>
<p><br></p>

<p>Through the conducted experiments, I found that the twisting simulation was not so realistic. Espetially, the middle part of the garmment is much more bulky than the real one. After some analysis, I found the isotropic constitutive model caused the problem. Thus, I modified the deformation energy density function accroding to 2017 SIGGRAPH paper <a href="https://www.math.ucla.edu/~cffjiang/research/cloth/paper.pdf" target="_blank" rel="noopener noreferrer">“Anisotropic Elastoplasticity for Cloth, Knit and Hair Frictional Contact”</a>. The following shows the difference between the original and the improved simulation. Note that physical parameters are set the same and only the energy density function is different. The updated version on the right is closer the the real garment.</p>

<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/8-twist-ori.gif" alt="" title="example image">
    </div>
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/7-twist-real.gif" alt="" title="example image">
    </div>  
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/8-twist-improved.gif" alt="" title="example image">
    </div>  
</div>
<p><br></p>

<p>I also started to develop my simulation playground in a more organized way. The cylinder shape static boundary is added with softened signed distance function (for a smoother gradient). Here are some preliminary results.</p>

<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/9-drop0.gif" alt="" title="example image">
    </div>
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/9-drop1.gif" alt="" title="example image">
    </div>
</div>
<div class="row"> 
        <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/9-drop2.gif" alt="" title="example image">
    </div>
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/9-drop4.gif" alt="" title="example image">
    </div>   
</div>
<p><br></p>

<p>With some further updates, I have reproduced ~80% of the cloth modeling methods proposed in <a href="https://www.math.ucla.edu/~cffjiang/research/cloth/paper.pdf" target="_blank" rel="noopener noreferrer">“Anisotropic Elastoplasticity for Cloth, Knit and Hair Frictional Contact”</a>. I am satisfied with the following results. For the next step, I will explore how to train a NN controller using this differentiable simulator. To my understanding, some layers in the NN approximate and store the the state-dependent jacobian matrix of the deformable object somehow efficiently, so we don’t need to update J(x) in real time as in servoing-based methods. As many examples have been demonstrated in <a href="https://arxiv.org/abs/1910.00935" target="_blank" rel="noopener noreferrer">“DiffTaichi”</a>, hopefully, this goal can be achieved soon.</p>

<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/10-drop0.gif" alt="" title="example image">
    </div>
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/10-drop1.gif" alt="" title="example image">
    </div>
</div>
<div class="row"> 
        <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/10-drop2.gif" alt="" title="example image">
    </div>
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/10-drop3.gif" alt="" title="example image">
    </div>   
</div>
<p><br></p>

<p>I recently found a promising related pioneer work <a href="http://plasticinelab.csail.mit.edu/" target="_blank" rel="noopener noreferrer">“PlasticineLab: A Soft-Body Manipulation Benchmark with Differentiable Physics”</a>. I decided to learn from it!</p>

<h2> Miscellaneous </h2>

<p>I aslo attached two <strong>wrong</strong> implementations of the return mapping. It is hilarious how the material behaves. No one likes explosion except Deidara.</p>
<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/3-jiang1.gif" alt="" title="example image">
    </div>
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/cloth/4-jiang2.gif" alt="" title="example image">
    </div>  
</div>
<p><br></p>

<p>I might join EPFL in 2023 as a PhD student. 亦可赛艇!</p>

<h2> Reference Materials</h2>
<ul>
  <li><a href="https://www.taichi-lang.org/" target="_blank" rel="noopener noreferrer">Taichi Lang</a></li>
  <li><a href="https://docs.taichi-lang.org/tgc01" target="_blank" rel="noopener noreferrer">Taichi Graphics Course</a></li>
  <li><a href="https://www.science.org/doi/10.1126/scirobotics.abd8803" target="_blank" rel="noopener noreferrer">Modeling, learning, perception, and control methods for deformable object manipulation</a></li>
  <li><a href="https://www.science.org/doi/10.1126/scirobotics.abm6010" target="_blank" rel="noopener noreferrer">Learning garment manipulation policies toward robot-assisted dressing</a></li>
  <li><a href="https://ieeexplore.ieee.org/document/9097275" target="_blank" rel="noopener noreferrer">A Grasping-Centered Analysis for Cloth Manipulation</a></li>
  <li><a href="https://www.math.ucla.edu/~cffjiang/research/mpmcourse/mpmcourse.pdf" target="_blank" rel="noopener noreferrer">The Material Point Method for Simulating Continuum Materials</a></li>
</ul>

<!-- <div class="row">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/1.jpg" alt="" title="example image"/>
    </div>
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/3.jpg" alt="" title="example image"/>
    </div>
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/5.jpg" alt="" title="example image"/>
    </div>
</div>
<div class="caption">
    Caption photos easily. On the left, a road goes through a tunnel. Middle, leaves artistically fall in a hipster photoshoot. Right, in another hipster photoshoot, a lumberjack grasps a handful of pine needles.
</div>
<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/5.jpg" alt="" title="example image"/>
    </div>
</div>
<div class="caption">
    This image can also have a caption. It's like magic.
</div>

You can also put regular text between your rows of images.
Say you wanted to write a little bit about your project before you posted the rest of the images.
You describe how you toiled, sweated, *bled* for your project, and then... you reveal it's glory in the next row of images.


<div class="row justi

Alt Textfy-content-sm-center">
    <div class="col-sm-8 mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/6.jpg" alt="" title="example image"/>
    </div>
    <div class="col-sm-4 mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/11.jpg" alt="" title="example image"/>
    </div>
</div>
<div class="caption">
    You can also have artistically styled 2/3 + 1/3 images, like these.
</div> -->

<!-- The code is simple.
Just wrap your images with `<div class="col-sm">` and place them inside `<div class="row">` (read more about the <a href="https://getbootstrap.com/docs/4.4/layout/grid/">Bootstrap Grid</a> system).
To make images responsive, add `img-fluid` class to each; for rounded corners and shadows use `rounded` and `z-depth-1` classes.
Here's the code for the last row of images above:

```html
<div class="row justify-content-sm-center">
    <div class="col-sm-8 mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/6.jpg" alt="" title="example image"/>
    </div>
    <div class="col-sm-4 mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/11.jpg" alt="" title="example image"/>
    </div>
</div>
``` -->

  </article>

</div>

    </div>

    <!-- Footer -->

    
<footer class="fixed-bottom">
  <div class="container mt-0">
    © Copyright 2022 Luyin  Hu.
    
    
    
  </div>

  <!-- Begin Web-Stat code v 7.0 -->
  <span id="wts2112339"></span>
  <script>
  var wts7 = {};
  wts7.invisible='yes';
  wts7.page_name='';
  wts7.group_name='';
  wts7.conversion_number='';
  wts7.user_id='';
  var wts=document.createElement('script');wts.async=true;
  wts.src='https://app.ardalio.com/log7.js';document.head.appendChild(wts);
  wts.onload = function(){ wtslog7(2112339,5); };
  </script><noscript><a href="https://www.web-stat.com" target="_blank" rel="noopener noreferrer">
  <img src="https://app.ardalio.com/7/5/2112339.png" alt="Web-Stat site stats"></a></noscript>
  <!-- End Web-Stat code v 7.0 -->
</footer>



  </body>

  <!-- Bootsrap & MDB scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.4.4/umd/popper.min.js" integrity="sha512-eUQ9hGdLjBjY3F41CScH3UX+4JDSI9zXeroz7hJ+RteoCaY+GP/LDoM8AO+Pt+DRFw3nXqsjh9Zsts8hnYv8/A==" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha512-M5KW3ztuIICmVIhjSqXe01oV2bpe248gOxqmlcYrEzAvws7Pw3z6BK0iGbrwvdrUQUhi3eXgtxp5I8PDo9YfjQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js" integrity="sha512-Mug9KHKmroQFMLm93zGrjhibM2z2Obg9l6qFG2qKjXEXkMp/VDkI4uju9m4QKPjWSwQ6O2qzZEnJDEeCw0Blcw==" crossorigin="anonymous"></script>

  
<!-- Mansory & imagesLoaded -->
<script defer src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<script defer src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
<script defer src="/assets/js/mansory.js" type="text/javascript"></script>


  


<!-- Medium Zoom JS -->
<script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
<script src="/assets/js/zoom.js"></script>


<!-- Load Common JS -->
<script src="/assets/js/common.js"></script>


</html>
